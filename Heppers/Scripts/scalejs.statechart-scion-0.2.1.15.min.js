define("scalejs.statechart-scion/state.builder",["scalejs!core","scion"],function(e,t){function i(e){function r(e){function n(n){if(e.onEntry)throw new Error("Only one `onEntry` action is allowed.");if(typeof n!="function")throw new Error("`onEntry` takes a function as a parameter.");return e.onEntry=n,t}function r(n){if(e.onExit)throw new Error("Only one `onExit` action is allowed.");if(typeof n!="function")throw new Error("`onExit` takes a function as a parameter.");return e.onExit=n,t}function i(t){var n={};return t&&(n.type="internal"),e.transitions||(e.transitions=[]),e.transitions.push(n),n}function s(e,n,r){if(!e)throw new Error("`transition` is undefined.");if(typeof n=="string"){e.target=n.split(" ");if(r){if(typeof r!="function")throw new Error("`action` must be an action.");e.onTransition=r}return t}if(typeof n=="function"){if(r)throw new Error("`goto` parameters should be either target id(s) or action function or both.");return e.onTransition=n,t}throw new Error("`goto` parameters should be either target id(s) or action function or both.")}function o(e,t){return s(i(),e,t)}function u(e,t){return s(i(!0),e,t)}function a(e,n){var r=i(),o={doNothing:t,"goto":function(e,t){return s(r,e,t)},gotoInternally:function(e,t){return r.type="internal",s(r,e,t)}};if(typeof e=="string"){r.event=e;if(n!==undefined){if(typeof n!="function")throw new Error("`condition` must be a function.");r.cond=n}return o}if(typeof e=="function"){if(n!==undefined)throw new Error("`on` parameters should be either an event name or condition function or both.");return r.cond=e,o}throw new Error("`on` parameters should be either an event name or condition function or both.")}function f(){return e}var t;return t={isBuilder:!0,onEntry:n,onExit:r,on:a,"goto":o,gotoInternally:u,toSpec:f},t}function i(e,t){var i=1;if(arguments.length>1){if(!t.isBuilder){i=2;if(t.initial){if(e.parallel)return new Error("`initial` shouldn't be specified on parallel region.");e.initial=t.initial}t.parallel&&(e.parallel=t.parallel)}arguments.length>i&&(e.states=n(arguments,i).map(function(e){return e.toSpec()}))}return r(e)}function s(e){return typeof e=="string"?i.apply(null,[{id:e}].concat(n(arguments,1))):i.apply(null,[{}].concat(n(arguments,0)))}function o(e){return typeof e=="string"?i.apply(null,[{id:e,type:"parallel"}].concat(n(arguments,1))):i.apply(null,[{parallel:!0}].concat(n(arguments)))}function u(){var n=s.apply(null,arguments);return new t.Statechart(n.toSpec(),e)}return{state:s,parallel:o,statechart:u}}var n=e.array.toArray,r;return r=i({logStatesEnteredAndExited:!1}),{builder:i,state:r.state,parallel:r.parallel,statechart:r.statechart}}),define("scalejs.statechart-scion/state",["scalejs!core","./state.builder","scion"],function(e,t,n){function p(e){return o(e,"states")?r.make(e).concat(r.from(e.states).selectMany(p)):r.make(e)}function d(e,t){var n=p(e).firstOrDefault(function(e){return e.id===t});return n}function v(e,t){var n=p(e).firstOrDefault(function(e){return e.states&&e.states.some(function(e){return e.id===t})});return n}function m(){return a(function(e,t){var n=t.toSpec(),r,i;r=d(c,e);if(!r)throw new Error('Parent state "'+e+"\" doesn't exist");if(o(n,"id")){i=d(c,n.id);if(i)throw new Error('State "'+n.id+'" already exists.')}o(r,"states")||(r.states=[]),r.states.push(n)}).apply(null,arguments)}function g(t){if(e.isApplicationRunning())throw new Error("Can't register a state while application is running.");i(arguments,1).forEach(m(t))}function y(){if(e.isApplicationRunning())throw new Error("Can't unregister a state while application is running.");i(arguments).forEach(function(e){var t=v(c,e),n=r.from(t.states).first(function(t){return t.id===e});s(t.states,n)})}function b(e,t,n){var r;if(u(e,"string"))r={name:e};else{if(!u(e,"name"))throw new Error("event object should have `name` property.");r=e}!o(n)&&u(t,"number")?n=t:r.data=t,h.send(r,{delay:n})}var r=e.linq.enumerable,i=e.array.toArray,s=e.array.removeOne,o=e.object.has,u=e.type.is,a=e.functional.curry,f=t.state,l=t.parallel,c,h;return c=f("scalejs-app",l("root")).toSpec(),e.onApplicationEvent(function(e){switch(e){case"started":h=new n.Statechart(c,{logStatesEnteredAndExited:!1}),h.start();break;case"stopped":}}),{registerStates:g,unregisterStates:y,raise:b,builder:t}}),define("scalejs.statechart-scion",["scalejs!core","./scalejs.statechart-scion/state"],function(e,t){e.registerExtension({state:t})});